/*! bootstrap-calendar 2013-06-26 */
https://github.com/Serhioromano/bootstrap-calendar.git
"use strict";Date.prototype.getWeek=function(){var t=new Date(this.getFullYear(),0,1);return Math.ceil(((this.getTime()-t.getTime())/864e5+t.getDay()+1)/7)},Date.prototype.getMonthFormatted=function(){var t=this.getMonth()+1;return 10>t?"0"+t:t},Date.prototype.getDateFormatted=function(){var t=this.getDate();return 10>t?"0"+t:t},function(t){function e(e){return t.ajaxSetup({dataType:"json",type:"post",async:!1}),n=t.extend(!0,{},a,e),s.css("width",n.width),this.view.call(this),this}var a={width:"100%",view:"month",day:"now",first_day:1,events_url:"",tmpl_path:"tmpls/",classes:{months:{inmonth:"cal-day-inmonth",outmonth:"cal-day-outmonth",saturday:"cal-day-weekend",sunday:"cal-day-weekend",holidays:"cal-day-holiday",today:"cal-day-today"}},holidays:{"08-03":"International Women's Day","25-12":"Christmas's","01-05":"International labor day"},views:{year:{slide_events:1},month:{slide_events:1}},onAfterEventsLoad:function(){},onBeforeEventsLoad:function(t){t()},onAfterViewLoad:function(){},events:[],position:{start:new Date,end:new Date},templates:{year:"",month:"",week:"",day:""},"break":!1},n={},s=null;e.prototype.set_options=function(e){t.extend(n,e)},e.prototype.render=function(){s.html(""),this.load_template(n.view),this.break=!1;var e={};e.events=[],e.cal=this,e.day=1,e.months=1==n.first_day?[language.d1,language.d2,language.d3,language.d4,language.d5,language.d6,language.d0]:[language.d0,language.d1,language.d2,language.d3,language.d4,language.d5,language.d6];var a=parseInt(n.position.start.getTime()),o=parseInt(n.position.end.getTime());switch(t.each(n.events,function(t,n){o>parseInt(n.start)&&parseInt(n.end)>a&&e.events.push(n)}),n.view){case"month":break;case"week":break;case"day":}e.start=new Date(n.position.start.getTime()),e.lang=language,s.append(n.templates[n.view](e)),this.update()},e.prototype._week=function(){this.load_template("week-days");var e={},a=parseInt(n.position.start.getTime()),s=parseInt(n.position.end.getTime()),o=[];return t.each(n.events,function(t,e){s>parseInt(e.start)&&parseInt(e.end)>a&&(e.start_day=new Date(parseInt(e.start)).getDay(),1==n.first_day&&(e.start_day=e.start_day-1),0>n.start_day&&(e.start_day=0),e.days=864e5>=e.end-e.start?1:(e.end-e.start)/864e5,a>e.start&&(e.days=e.days-(a-e.start)/864e5,e.start_day=0),e.days=Math.ceil(e.days),e.start_day+e.days>7&&(e.days=7-e.start_day),1==n.first_day,o.push(e))}),e.events=o,n.templates["week-days"](e)},e.prototype._month=function(e){this.load_template("year-month");var a={},s=e+1;a.data_day=n.position.start.getFullYear()+"-"+(10>s?"0"+s:s)+"-"+"01",a.month_name=language["m"+e];var o=new Date(n.position.start.getFullYear(),e,1,0,0,0),i=parseInt(o.getTime()),r=parseInt(new Date(n.position.start.getFullYear(),e+1,0,0,0,0).getTime()),l=[];return t.each(n.events,function(t,e){r>parseInt(e.start)&&parseInt(e.end)>i&&l.push(e)}),a.events=l,n.templates["year-month"](a)},e.prototype._day=function(e,a){this.load_template("month-day");var s={tooltip:""},o=n.classes.months.outmonth,i=n.position.start.getDay();2==n.first_day?i++:i=0==i?7:i,a=a-i+1;var r=new Date(n.position.start.getFullYear(),n.position.start.getMonth(),a,0,0,0);if(a>0&&(o=n.classes.months.inmonth),a+1>n.position.end.getDate()&&(this.break=!0),a>n.position.end.getDate()&&(a-=n.position.end.getDate(),o=n.classes.months.outmonth),0==r.getDay()&&o==n.classes.months.inmonth&&(o=n.classes.months.sunday),6==r.getDay()&&o==n.classes.months.inmonth&&(o=n.classes.months.saturday),r.toDateString()==(new Date).toDateString()&&(o=n.classes.months.today),0>=a){var l=new Date(n.position.start.getFullYear(),n.position.start.getMonth(),0).getDate();a=l-Math.abs(a),o+=" cal-month-first-row"}var d=r.getDateFormatted()+"-"+r.getMonthFormatted();t.inArray(d,_.keys(n.holidays))>-1&&(o+=" "+n.classes.months.holidays,s.tooltip=n.holidays[d]),s.data_day=r.getFullYear()+"-"+r.getMonthFormatted()+"-"+(10>a?"0"+a:a),s.cls=o,s.day=a;var c=parseInt(r.getTime()),h=parseInt(c+864e5),p=[];return t.each(n.events,function(t,e){h>parseInt(e.start)&&parseInt(e.end)>c&&p.push(e)}),s.events=p,n.templates["month-day"](s)},e.prototype.view=function(t){t&&(n.view=t),this.init_position.call(this),this.load_url.call(this),this.render.call(this),n.onAfterViewLoad.call(this,n.view)},e.prototype.navigate=function(e,a){var s=t.extend({},n.position);if("next"==e)switch(n.view){case"year":s.start.setFullYear(n.position.start.getFullYear()+1);break;case"month":s.start.setMonth(n.position.start.getMonth()+1);break;case"week":s.start.setDate(n.position.start.getDate()+7);break;case"day":s.start.setDate(n.position.start.getDate()+1)}else if("prev"==e)switch(n.view){case"year":s.start.setFullYear(n.position.start.getFullYear()-1);break;case"month":s.start.setMonth(n.position.start.getMonth()-1);break;case"week":s.start.setDate(n.position.start.getDate()-7);break;case"day":s.start.setDate(n.position.start.getDate()-1)}else"today"==e?s.start.setTime((new Date).getTime()):t.error(language.error_where.format(e));n.day=s.start.getFullYear()+"-"+s.start.getMonthFormatted()+"-"+s.start.getDateFormatted(),this.view.call(this),_.isFunction(a)&&a()},e.prototype.init_position=function(){var e,a,s;if("now"==n.day){var o=new Date;e=o.getFullYear(),a=o.getMonth(),s=o.getDate()}else if(n.day.match(/^\d{4}-\d{2}-\d{2}$/g)){var i=n.day.split("-");e=i[0],a=i[1]-1,s=i[2]}else t.error(language.error_dateformat.format(n.day));switch(n.view){case"year":n.position.start.setTime(new Date(e,0,1).getTime()),n.position.end.setTime(new Date(e,12,0,23,59,59).getTime());break;case"month":n.position.start.setTime(new Date(e,a,1).getTime()),n.position.end.setTime(new Date(e,a+1,0,23,59,59).getTime());break;case"day":n.position.start.setTime(new Date(e,a,s).getTime()),n.position.end.setTime(new Date(e,a,s,23,59,59).getTime());break;case"week":var r=new Date(e,a,s),l=r.getDate()-r.getDay();1==n.first_day&&(l+=1);var d=l+6;n.position.start.setTime(new Date(e,a,l).getTime()),n.position.end.setTime(new Date(e,a,d,23,59,59).getTime());break;default:t.error(language.error_noview.format(n.view))}return this},e.prototype.title=function(){var t=n.position.start;switch(n.view){case"year":return language.title_year.format(t.getFullYear());case"month":return language.title_month.format(language["m"+t.getMonth()],t.getFullYear());case"week":return language.title_week.format(t.getWeek(),t.getFullYear());case"day":return language.title_day.format(language["d"+t.getDay()],t.getDate(),language["m"+t.getMonth()],t.getFullYear())}},e.prototype.load_url=function(){n.events_url||t.error(language.error_loadurl),n.onBeforeEventsLoad(function(){t.ajax({url:n.events_url,data:{from:n.position.start.getTime(),to:n.position.end.getTime()}}).done(function(e){e.success||t.error(e.error),n.events=e.result,n.onAfterEventsLoad(e.result)})})},e.prototype.load_template=function(e){n.templates[e]||t.ajax({url:n.tmpl_path+e+".html",dataType:"html",type:"GET"}).done(function(t){n.templates[e]=_.template(t)})},e.prototype.update=function(){var e=this;t('*[rel="tooltip"]').tooltip(),t("*[data-cal-date]").click(function(){console.log(t(this).data("cal-date")),n.day=t(this).data("cal-date"),e.view(t(this).data("cal-view"))}),t(".cal-cell").dblclick(function(){n.day=t("[data-cal-date]",this).data("cal-date"),e.view(t("[data-cal-date]",this).data("cal-view"))}),this["_update_"+n.view]()},e.prototype._update_day=function(){},e.prototype._update_week=function(){},e.prototype._update_year=function(){this._update_month_year()},e.prototype._update_month=function(){this._update_month_year();var e=t(document.createElement("div")).attr("id","cal-week-box");e.html(language.week);var a=n.position.start.getFullYear()+"-"+n.position.start.getMonthFormatted()+"-";t(".cal-month-box .cal-row-fluid").each(function(n,s){var o=t(s);o.bind("mouseenter",function(){var n=t(".cal-span1:first-child .cal-month-day",o),s=n.hasClass("cal-month-first-row")?1:t("[data-cal-date]",n).text();s=10>s?"0"+s:s,e.attr("data-cal-week",a+s).show().appendTo(n)}).bind("mouseleave",function(){e.hide()})});var s=this;e.click(function(){n.day=t(this).data("cal-week"),s.view("week")}),t("a.event").mouseenter(function(){t("a.event"+t(this).data("event-id")).parents(".cal-span1").addClass("day-highlight dh-"+t(this).data("event-class"))}),t("a.event").mouseleave(function(){t("div.cal-span1").removeClass("day-highlight dh-"+t(this).data("event-class"))})},e.prototype._update_month_year=function(){if(n.views[n.view].slide_events){var e=0,a=t(document.createElement("div")).attr("id","cal-day-box").html('<i class="icon-chevron-down"></i>');t(".cal-month-day, .cal-year-box .span3").each(function(n,s){t(s).bind("mouseenter",function(){0!=t(".events-list",s).length&&t(s).children("[data-cal-date]").text()!=e&&a.show().appendTo(s)}),t(s).bind("mouseleave",function(){a.hide()})});var s=t(document.createElement("div")).attr("id","cal-slide-box");s.hide().click(function(t){t.stopPropagation()}),this.load_template("events-list"),a.click(function(a){a.stopPropagation();var o=t(this),i=o.parents(".cal-cell"),r=o.parents(".cal-row-fluid"),l=i.data("cal-row");o.fadeOut("fast"),s.html(n.templates["events-list"]({events:t(".events-list a.event",i)})).slideUp("fast",function(){r.after(s),e=t("[data-cal-date]",i).text(),t("#cal-slide-tick").addClass("tick"+l).show(),s.slideDown("fast",function(){t("body").one("click",function(){s.slideUp("fast"),e=0})})}),t("a.event-item").mouseenter(function(){t("a.event"+t(this).data("event-id")).parents(".cal-span1").addClass("day-highlight dh-"+t(this).data("event-class"))}),t("a.event-item").mouseleave(function(){t("div.cal-span1").removeClass("day-highlight dh-"+t(this).data("event-class"))})})}},t.fn.calendar=function(t){return s=this,new e(t)}}(jQuery);